# MySQL Slave Configuration
# Optimized for Read Operations and Replication

[mysqld]
# Server identification (will be overridden by docker command)
server-id = 2

# Binary logging for potential promotion to master
log-bin = mysql-bin
binlog-format = ROW
sync-binlog = 0
log-slave-updates = ON

# GTID Configuration
gtid-mode = ON
enforce-gtid-consistency = ON

# Read-only configuration
read-only = ON
super-read-only = ON

# Replication settings
relay-log = mysql-relay-bin
relay-log-recovery = ON
slave-parallel-workers = 4
slave-preserve-commit-order = ON
slave-parallel-type = LOGICAL_CLOCK
slave-compressed-protocol = ON

# Crash-safe replication
master-info-repository = TABLE
relay-log-info-repository = TABLE

# Performance settings (optimized for reads)
innodb-buffer-pool-size = 512M
innodb-log-file-size = 128M
innodb-log-buffer-size = 8M
innodb-flush-log-at-trx-commit = 2
innodb-file-per-table = 1
innodb-open-files = 300

# Connection settings
max-connections = 500
max-connect-errors = 1000
thread-cache-size = 50
table-open-cache = 4000
table-definition-cache = 1400

# Query cache (can be enabled on read slaves)
query-cache-type = 1
query-cache-size = 128M
query-cache-limit = 2M

# Slow query log
slow-query-log = 1
slow-query-log-file = /var/log/mysql/mysql-slow.log
long-query-time = 2

# Error log
log-error = /var/log/mysql/error.log

# General log (disabled for performance)
general-log = 0

# Timeout settings
wait-timeout = 28800
interactive-timeout = 28800

# Character set
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# SQL mode
sql-mode = STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO

# MyISAM settings
key-buffer-size = 16M
myisam-recover-options = BACKUP,FORCE

# Network settings
max-allowed-packet = 64M
bind-address = 0.0.0.0

# Security
skip-name-resolve = 1

# Skip slave start (will be started by setup script)
skip-slave-start = 1

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4
/var/www/backend/storage/logs/*.log {
    daily
    maxsize 10M
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 664 www-data www-data
    postrotate
        # Send USR1 signal to php-fpm to reopen log files
        /usr/bin/killall -USR1 php-fpm8.2 2>/dev/null || true
        
        # Restart Laravel workers to pick up new log files
        /usr/bin/supervisorctl restart laravel-worker:* 2>/dev/null || true
        
        # Log rotation event
        echo "$(date '+%Y-%m-%d %H:%M:%S') - Laravel logs rotated" >> /var/www/backend/storage/logs/rotation.log
    endscript
}

# Special handling for Laravel application log
/var/www/backend/storage/logs/laravel.log {
    size 10M
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 664 www-data www-data
    copytruncate
    postrotate
        echo "$(date '+%Y-%m-%d %H:%M:%S') - Laravel application log rotated" >> /var/www/backend/storage/logs/rotation.log
    endscript
}

# Nginx logs (if mounted)
/var/www/backend/storage/logs/nginx/*.log {
    daily
    maxsize 50M
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 644 nginx nginx
    postrotate
        /usr/bin/nginx -s reload 2>/dev/null || true
    endscript
}